# 外卖店铺视频生成系统

> 基于 Google Veo 3.1 AI 技术的智能视频生成系统，为外卖商家快速生成电影级广告视频

![Next.js](https://img.shields.io/badge/Next.js-14+-black)
![TypeScript](https://img.shields.io/badge/TypeScript-5+-blue)
![Tailwind CSS](https://img.shields.io/badge/Tailwind-3+-38bdf8)
![Veo 3.1](https://img.shields.io/badge/Veo-3.1-red)
![License](https://img.shields.io/badge/license-MIT-green)

## 📋 项目简介

外卖店铺视频生成系统是一款基于 **Google Veo 3.1** 和 **Gemini 2.5 Flash Image** 的智能视频生成工具，专为外卖商家设计。支持三种生成模式：

1. **文字生成模式** - 输入经营品类和主推菜品，Coze AI 自动优化提示词并生成专业视频
2. **图片生成模式** - 上传产品图片，自动生成电影级广告（镜头推进 + 360°环绕 + 纯白热气 + 金色粒子 + 液体冒泡）
3. **首尾帧生成模式** - 上传产品图 → AI 生成爆炸分层尾图 → 生成食材分解动画（快速推进 + 金色粒子 + 食材飘浮分解）

### ✨ 核心特性

- 🎬 **电影级质感** - 基于 Veo 3.1 模型，8秒好莱坞级别视频广告，包含专业运镜和特效
- 🤖 **AI Prompt 优化** - 集成 Coze AI 流式响应，实时优化视频生成提示词
- ⚡ **三模式生成** - 支持文字生成、图片转视频、首尾帧生成三种模式，满足不同场景需求
- 🎨 **丰富视觉特效** - 纯白色热气、金黄色粒子、液体冒泡、火锅翻滚、专业打光、色彩分级
- 🎥 **专业运镜** - 镜头快速推进 + 摄像机 360° 环绕旋转（前快后慢），展示食物所有角度
- 🍔 **食材分解动画** - Gemini AI 自动生成爆炸分层图 + 食材垂直飘浮分解 + 金色粒子环绕
- 🎨 **严格颜色控制** - 仅允许白色蒸汽和金黄色粒子，杜绝蓝色/紫色等杂色烟雾
- 📐 **浏览器端处理** - 使用 FFmpeg.wasm 在浏览器端实时调整视频尺寸为 692×390
- 📥 **双重下载选项** - 支持下载原始 16:9 视频或自动调整尺寸后的视频，带进度显示
- 🖼️ **Base64 编码** - 图片直接转 Base64，无需依赖外部图床，确保稳定性
- 📱 **响应式设计** - 完美适配桌面和移动设备，流畅体验

## 🚀 快速开始

### 环境要求

- Node.js 18.0 或更高版本
- npm 或 yarn 包管理器

### 安装步骤

1. **克隆项目**

```bash
git clone <项目地址>
cd sor2视频生成系统
```

2. **安装依赖**

```bash
npm install
# 或
yarn install
```

3. **配置环境变量**

复制 `.env.example` 到 `.env.local` 并配置您的 API 密钥：

```bash
cp .env.example .env.local
```

编辑 `.env.local`：

```env
# 云雾 Veo API 配置
NEXT_PUBLIC_API_URL=http://yunwu.ai/v1
SORA_API_KEY=your-veo-api-key-here
SORA_MODEL=veo3.1

# Gemini AI 生图 API 配置
GEMINI_API_URL=https://newapi.pockgo.com/v1
GEMINI_API_KEY=your-gemini-api-key-here
GEMINI_MODEL=gemini-2.5-flash-image

# Coze AI 配置（可选 - 用于 Prompt 优化）
COZE_API_URL=https://api.coze.cn/v3/chat
COZE_BOT_ID=your-bot-id
COZE_ACCESS_TOKEN=your-access-token

NODE_ENV=development
```

4. **启动开发服务器**

```bash
npm run dev
# 或
yarn dev
```

5. **访问应用**

打开浏览器访问 [http://localhost:3000](http://localhost:3000)

## 🏗️ 技术架构

### 技术栈

- **框架**: Next.js 14+ (App Router)
- **语言**: TypeScript 5+
- **样式**: Tailwind CSS 3+
- **UI 组件**: shadcn/ui
- **图标库**: Lucide React
- **状态管理**: React Hooks
- **视频处理**: FFmpeg.wasm
- **AI 模型**:
  - Google Veo 3.1 (视频生成)
  - Gemini 2.5 Flash Image (图片生成)
  - Coze AI (Prompt 优化)

### 项目结构

```
sor2视频生成系统/
├── app/                      # Next.js App Router
│   ├── api/                 # API 路由
│   │   ├── generate-video/  # 视频生成端点
│   │   ├── generate-image/  # Gemini 图片生成端点（尾图）
│   │   └── optimize-prompt/ # Prompt 优化端点
│   ├── page.tsx             # 主页面
│   ├── layout.tsx           # 根布局
│   └── globals.css          # 全局样式
├── components/              # React 组件
│   ├── ui/                  # shadcn/ui 基础组件
│   │   ├── button.tsx
│   │   ├── input.tsx
│   │   ├── card.tsx
│   │   └── progress.tsx
│   ├── VideoGenerator.tsx   # 视频生成表单（三种模式）
│   ├── VideoPlayer.tsx      # 视频播放器
│   └── ImageUpload.tsx      # 图片上传组件
├── lib/                     # 工具库
│   ├── api.ts              # API 调用封装
│   ├── prompts.ts          # 提示词模板（文字/图片/首尾帧）
│   ├── videoProcessor.ts   # 视频处理工具
│   └── utils.ts            # 工具函数
├── types/                   # TypeScript 类型
│   └── video.ts            # 视频相关类型
└── public/                  # 静态资源
```

## 📖 使用说明

### 文字生成模式

1. 选择"文字生成"标签页
2. 输入经营品类（例如："川菜馆"）
3. 输入主推菜品名称（例如："水煮鱼"）
4. 点击"优化 Prompt"按钮，AI 自动生成优化后的提示词
5. 查看优化后的提示词内容
6. 点击"生成视频"按钮
7. 等待 5-6 分钟，系统将自动生成视频
8. 预览生成的视频效果
9. 选择下载方式：
   - **下载 (692×390)** - 自动调整尺寸后下载
   - **下载原始视频** - 直接下载不处理

### 图片生成模式

1. 选择"图片生成"标签页
2. 上传产品主图（支持 JPG、PNG、GIF，最大 5MB）
3. 图片自动转换为 Base64 编码（无需外部图床）
4. 点击"生成视频"按钮
5. 等待 5-6 分钟，系统将生成包含以下特效的电影级视频：
   - 前 2 秒：快速镜头推进（从中距离到极近特写）
   - 后 6 秒：摄像机 360° 环绕旋转展示（食物静止，摄像机绕圈）
   - 纯白色热气从食物表面持续上升
   - 金黄色粒子螺旋环绕并逐渐融入食物
   - 液体冒泡翻滚效果（适用于有汤汁的菜品）
   - 专业三点布光（暖色主光 + 橙色补光 + 冷色轮廓光）
   - 电影级色彩分级（高饱和度、暖色温、戏剧对比）
   - **颜色保证**：仅白色蒸汽和金黄色粒子，无其他颜色烟雾
6. 预览生成的视频效果
7. 选择下载方式：
   - **下载 (692×390)** - 使用 FFmpeg 在浏览器端自动调整尺寸后下载
   - **下载原始视频** - 直接下载 16:9 原始视频

### 首尾帧生成模式（食材分解动画）

1. **第一步：上传产品首图**
   - 选择"首尾帧生成"标签页
   - 上传完整的产品图片（支持 JPG、PNG、GIF，最大 5MB）
   - 图片会作为首图（视频起始画面）
   - 图片自动转换为 Base64 编码

2. **第二步：生成爆炸分层尾图**
   - 点击"生成尾图"按钮
   - 系统调用 **Gemini 2.5 Flash Image** AI 模型
   - 等待 30-60 秒，AI 自动分析产品图并生成爆炸分层图：
     - 底部：空碗/空盘/底层面包（处于最底部）
     - 中间：各层食材按垂直顺序分离（米饭、肉类、蔬菜、酱料等）
     - 顶部：顶层装饰或盖子（处于最高位置）
     - 所有食材保持垂直中心对齐，层间间距 2-5cm
     - 明亮均匀的专业食品摄影灯光
     - 干净的纯色背景（暖橙色或琥珀色）
   - 预览生成的尾图效果

3. **第三步：生成食材分解动画**
   - 点击"生成视频"按钮
   - 系统使用首图和尾图调用 **Google Veo 3.1** 生成 8 秒转场动画：

     **阶段 1 - 快速推进（0-2 秒）**
     - 摄像机从中距离快速推进到食物特写
     - 平滑加速运动（先中速后快速）
     - 食物保持完整状态
     - 电影感运镜模糊效果

     **阶段 2 - 金色粒子出现（2-2.8 秒）**
     - 摄像机锁定在特写位置（不再移动）
     - 数百个纯金黄色发光球体在食物上方出现
     - 粒子以螺旋轨迹环绕食物（半径 15-25cm）
     - 每个粒子发出明亮的金黄色光芒和光迹
     - 金色光芒从上方照亮食物表面
     - 食物保持完整状态，沐浴在金色光芒中

     **阶段 2.5 - 粒子淡出（2.8-3.2 秒）**
     - 金色粒子逐渐消失（透明度从 100% → 0%）
     - 部分粒子向上漂移，部分向外漂移
     - 3.2 秒时所有粒子完全消失
     - 灯光恢复正常食品摄影灯光

     **阶段 3 - 食材分解（3.2-8 秒）**
     - **无金色粒子**（已完全淡出）
     - 食材开始垂直分离成爆炸层视图：
       - 底层容器（碗/盘/底层面包）保持静止或微微下降
       - 各层食材以不同速度向上升起（瀑布式分离）
       - 分离动作平滑流畅（缓入缓出，非突然跳动）
       - 层间间距逐渐增大至 2-5cm
       - 所有层保持完整垂直中心对齐
     - 不同食材类型的动态效果：
       - 固体层（面包、肉饼）：平滑上升 + 轻微旋转（±5度）
       - 柔软食材（生菜、蔬菜）：上升时左右摇摆（±10度）
       - 液体层（酱料）：表面波纹流动效果
       - 小颗粒（芝麻、配料）：翻滚旋转运动
       - 芝士类：短暂拉伸效果显示弹性
     - 少量金黄色油滴飞溅（非魔法粒子，物理油滴）
     - 干净的爆炸视图，清晰展示分层结构
     - 所有食材到达最终悬浮位置，轻微上下浮动（±1-2mm）

   - 等待 5-6 分钟完成视频生成
   - 预览生成的视频效果
   - 选择下载方式：
     - **下载 (692×390)** - 自动调整尺寸后下载
     - **下载原始视频** - 直接下载 16:9 原始视频

**首尾帧模式适用场景**
- 汉堡/三明治类：展示面包、肉饼、蔬菜、芝士的分层结构
- 盖浇饭/盖码面：展示碗、米饭/面条、浇头、酱料的层次
- 蛋糕/甜品：展示底座、蛋糕层、奶油层、装饰的分解
- 寿司/卷类：展示海苔、米饭、馅料的组成结构
- 任何需要展示"产品构成"的食品广告

### 视频规格

| 参数 | 规格 |
|-----|------|
| 格式 | MP4 |
| 原始尺寸 | 16:9 |
| 调整后尺寸 | 692 × 390 像素 |
| 时长 | 8 秒 |
| 大小 | ≤ 50MB |

## 🔌 API 集成

### Veo 3.1 API 配置

系统使用 Google Veo 3.1 API 进行视频生成：

```typescript
const VEO_API_CONFIG = {
  baseURL: 'http://yunwu.ai/v1',
  endpoint: '/video/create',
  apiKey: process.env.VEO_API_KEY,
  model: 'veo3.1',
  timeout: 300000 // 5分钟
}
```

### Gemini 2.5 Flash Image API 配置

系统使用 Gemini 2.5 Flash Image 进行尾图生成：

```typescript
const GEMINI_API_CONFIG = {
  baseURL: 'https://newapi.pockgo.com/v1',
  endpoint: '/chat/completions',
  apiKey: process.env.GEMINI_API_KEY,
  model: 'gemini-2.5-flash-image',
  aspectRatio: '16:9',
  timeout: 60000 // 60秒
}
```

### Coze AI 配置

系统使用 Coze AI 进行 Prompt 优化：

```typescript
const COZE_CONFIG = {
  apiUrl: 'https://api.coze.cn/v3/chat',
  botId: process.env.COZE_BOT_ID,
  accessToken: process.env.COZE_ACCESS_TOKEN
}
```

### API 调用流程

#### 文字生成流程

```
用户输入品类和菜品 → 调用 Coze API 优化 Prompt →
展示优化后的提示词 → 用户确认 →
调用 Veo API 生成视频 → 轮询状态 →
返回视频 URL → 展示视频播放器 →
可选择调整尺寸并下载
```

#### 图片生成流程

```
用户上传图片 → 转换为 Base64 →
（可选）上传到 Imgur 获取 URL →
使用预设电影级 Prompt → 调用 Veo API →
轮询状态 → 返回视频 URL →
展示视频播放器 → 可选择调整尺寸并下载
```

#### 首尾帧生成流程

```
【步骤1】用户上传产品首图 → 转换为 Base64 →
（可选）上传到 Imgur 获取 URL →
展示首图预览

【步骤2】点击生成尾图 →
调用 Gemini 2.5 Flash Image API →
传递首图 + 爆炸分层提示词 →
等待 30-60 秒 →
Gemini AI 分析产品并生成爆炸分层图 →
从响应中提取图片 URL（支持 Markdown 格式） →
展示尾图预览（空碗 + 垂直分层的食材）

【步骤3】点击生成视频 →
使用首尾帧专用提示词（快速推进 + 金色粒子 + 食材分解）→
调用 Veo API（传递首图和尾图数组） →
轮询状态（queued → pending → processing → completed）→
返回视频 URL →
展示视频播放器（8秒食材分解动画）→
可选择调整尺寸并下载
```

## 🎬 视频特效说明

### 图片转视频特效

系统为图片生成模式预设了电影级特效：

**镜头运动**
- 前 2 秒：快速推进（中距离 → 极近特写）
- 后 6 秒：摄像机 360° 环绕旋转展示
  - 食物保持静止在中心位置
  - 前 180° - 3秒：快速环绕（60度/秒）
  - 后 180° - 3秒：慢速环绕（30度/秒）
  - 摄像机绕圈展示食物所有角度

**视觉特效（严格颜色限制）**
- **纯白色热气**：浓密蒸汽从食物表面多点上升，真实飘散效果
- **金黄色粒子**：数百个发光球体以螺旋轨迹环绕食物，逐渐融入表面并消失
- **液体冒泡**（如有汤汁/酱料）：气泡从底部上升，液面波动，油滴漂浮
- **火锅效果**（适用热菜）：沸腾翻滚，快速冒泡，食材在液体中微动
- **颜色保证**：仅允许白色蒸汽和金黄色粒子，不会出现蓝色、紫色或其他颜色的烟雾/气体

**灯光设置**
- 主光：45度角暖色调强光（营造高光和阴影）
- 补光：下方橙琥珀色柔光（照亮蒸汽和粒子）
- 轮廓光：冷色调边缘光（仅照亮食物轮廓，非烟雾）
- 背景：渐变至接近黑色，营造戏剧对比

**色彩分级**
- 饱和度 +30-40%（鲜艳诱人）
- 色温 3200K（暖橙金色调）
- 阴影自然暗色调（无蓝紫色调）
- 高光暖黄橙色调
- 液面反射暖色调（金色、琥珀色、橙色）

### 首尾帧食材分解特效

系统为首尾帧生成模式预设了电影级食材分解动画（8秒三阶段）：

**阶段 1 - 快速镜头推进（0-2 秒）**
- 摄像机从中距离快速加速推进至食物极近特写
- 推进速度：0-1秒中速 → 1-2秒快速（平滑加速）
- 食物保持完整组装状态
- 电影感运镜模糊效果
- 2 秒时摄像机到达特写位置并锁定（之后不再移动）

**阶段 2 - 金色粒子魔法效果（2-3.2 秒）**
- **2.0-2.8 秒：粒子出现并环绕**
  - 摄像机固定在特写位置（完全静止）
  - 数百个纯金黄色发光球体在食物上方逐渐出现
  - 粒子数量：从 10-20 个快速增加至 200-300 个
  - 粒子轨迹：以食物为中心螺旋环绕（半径 15-25cm）
  - 粒子大小：3-8mm 直径，大小不一营造景深
  - 发光效果：每个粒子发出明亮金黄色光芒 + 光迹
  - 照明效果：金色光芒从上方照亮食物表面，形成暖色高光
  - 食物状态：保持完整组装，沐浴在金色粒子光辉中
- **2.8-3.2 秒：粒子淡出消失**
  - 金色粒子逐渐淡化（透明度 100% → 0%）
  - 部分粒子向上漂移，部分向外漂移
  - 3.2 秒时所有粒子完全消失
  - 灯光恢复正常食品摄影灯光
  - 食物仍保持完整状态，清晰可见无粒子遮挡

**阶段 3 - 食材分解动画（3.2-8 秒）**
- **无金色粒子**（已在前一阶段完全淡出）
- **食材垂直分离过程**：
  - 底层容器（碗/盘/底层面包）保持静止或微微下降
  - 各层食材按自然叠放顺序向上升起
  - 分离速度：每层速度不同，形成瀑布式分离效果
  - 分离曲线：缓入缓出（ease-in-ease-out），流畅自然
  - 层间间距：从 0cm 逐渐增大至 2-5cm 最终间距
  - 垂直对齐：所有层保持完美中心对齐
- **不同食材的物理效果**：
  - 固体层（面包、肉饼、蛋糕）：平滑上升 + 轻微旋转（±5度）+ 到位后微微颤动
  - 柔软食材（生菜、薄片）：上升时左右摇摆（±10度）+ 叶片在气流中飘动
  - 液体层（酱料、汤汁）：表面波纹流动 + 轻微晃动 + 液滴可能分离漂浮
  - 小颗粒（芝麻、配料）：不同速度上升 + 翻滚旋转 + 微微偏离中心后回归
  - 芝士类：短暂拉伸效果显示弹性 + 边缘可能微微融化下垂
- **油滴飞溅效果**（仅在此阶段）：
  - 15-20 个金黄色小油滴（2-4mm）在食材分离时喷出
  - 抛物线轨迹，符合物理规律
  - 捕捉光线产生闪烁效果
  - 这是物理油滴，非魔法粒子（更重、更慢）
- **最终状态**：
  - 所有食材到达最终悬浮位置
  - 轻微上下浮动（±1-2mm）如在零重力中悬浮
  - 干净的爆炸视图，清晰展示分层结构
  - 明亮均匀的专业食品摄影灯光
  - 每层下方有柔和阴影增强景深

**严格规则**
- ✅ 金色粒子仅在首图阶段出现（2.0-3.2秒），在分解前完全消失
- ✅ 粒子颜色：纯金黄色（绝无蓝色、紫色、其他颜色）
- ✅ 分解阶段无粒子遮挡，清晰展示食材结构
- ✅ 摄像机在 2 秒后完全静止（无旋转、无移动）
- ❌ 不添加原图中不存在的食材
- ❌ 不改变食材颜色和外观
- ❌ 无文字、Logo、水印、图形叠加

## 🧪 测试

```bash
# 运行测试
npm run test

# 运行 linter
npm run lint

# 构建生产版本
npm run build
```

## 📦 部署

### Vercel 部署（推荐）

1. 将项目推送到 GitHub
2. 在 Vercel 中导入项目
3. 配置环境变量
4. 部署完成

### 自建服务器部署

```bash
# 构建项目
npm run build

# 启动生产服务器
npm run start
```

## 🔐 环境变量说明

| 变量名 | 说明 | 示例 |
|-------|------|------|
| `VEO_API_KEY` | Veo API 密钥（视频生成） | `sk-xxx...` |
| `VEO_MODEL` | Veo 模型名称 | `veo3.1` |
| `GEMINI_API_KEY` | Gemini API 密钥（图片生成） | `sk-xxx...` |
| `GEMINI_MODEL` | Gemini 模型名称 | `gemini-2.5-flash-image` |
| `GEMINI_API_URL` | Gemini API 地址 | `https://newapi.pockgo.com/v1` |
| `COZE_API_URL` | Coze API 地址（Prompt 优化） | `https://api.coze.cn/v3/chat` |
| `COZE_BOT_ID` | Coze Bot ID | `7569143894404366377` |
| `COZE_ACCESS_TOKEN` | Coze 访问令牌 | `sat_xxx...` |
| `IMGUR_CLIENT_ID` | Imgur 客户端 ID（可选） | `xxx...` |
| `NODE_ENV` | 环境类型 | `development` / `production` |

## 🛠️ 开发指南

### 代码规范

- 使用 TypeScript 进行类型检查
- 遵循 ESLint 配置规范
- 组件采用函数式编程
- 使用 Tailwind CSS 进行样式管理

### 提交规范

```bash
feat: 新增功能
fix: 修复 bug
docs: 文档更新
style: 代码格式调整
refactor: 代码重构
test: 测试相关
chore: 构建/工具链更新
```

## 🎯 项目亮点

1. **AI 三引擎架构** - 结合 Google Veo 3.1（视频生成）、Gemini 2.5 Flash Image（图片生成）和 Coze AI（提示词优化），实现多模式最优视频生成效果
2. **首创食材分解动画** - 独特的三阶段动画设计（快速推进 + 金色粒子魔法 + 食材分解），展示产品构成的教育性和视觉冲击力
3. **智能爆炸图生成** - 使用 Gemini AI 自动分析产品图并生成专业爆炸分层图，无需手动设计，AI 理解食材结构并垂直分离
4. **电影级质感提示词** - 精心设计的 2000+ 字专业提示词模板，涵盖运镜、灯光、特效、色彩分级、物理动画等电影制作要素
5. **严格颜色控制系统** - 通过多层次颜色限制，确保仅生成纯白色蒸汽和金黄色粒子，杜绝蓝/紫杂色
6. **分阶段粒子系统** - 金色粒子仅在首图（完整食物）阶段出现，分解阶段自动淡出，确保清晰展示食材结构
7. **浏览器端视频处理** - 使用 FFmpeg.wasm 在客户端处理视频，无需上传服务器，保护隐私且提高速度
8. **流式响应显示** - Coze API 流式响应实时展示 AI 优化过程，提升用户体验和透明度
9. **Base64 图片编码** - 避免外部图床依赖（Imgur 等），确保图片处理稳定性和系统独立性
10. **专业运镜设计** - 分段式运镜（2秒快速推进 + 固定特写），结合速度变化营造电影感
11. **物理真实特效** - 不同食材类型的差异化物理动画（固体旋转、柔软摇摆、液体波纹、芝士拉伸），符合真实物理规律
12. **三模式无缝切换** - 文字生成、图片生成、首尾帧生成三种模式，满足不同营销场景和用户需求
13. **响应式现代设计** - 基于 Tailwind CSS + shadcn/ui，完美适配各种设备尺寸

## 📄 许可证

MIT License

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

## 📞 联系方式

如有问题或建议，请通过以下方式联系：

- 提交 [Issue](项目地址/issues)

---

**🎉 祝您使用愉快！**
